{
  "name": "React",
  "description": "React SPA with yarn and build output",
  "commands": [
    "cd $cf$",
    "git fetch origin $branch$",
    "git checkout $branch$",
    "git reset --hard origin/$branch$",
    "yarn install",
    "yarn build",
    "rm -rf $rf$/build",
    "cp -r $cf$/build $rf$/"
  ],
  "preDeploy": [
  ],
  "postDeploy": [
    "pm2 delete $pm2Name$ || true",
    "sleep 1",
    "pm2 serve $rf$ $port$ --name $pm2Name$ --namespace \"$port$\" --spa"
  ],
  "nginx": {
    "enabled": true,
    "template": [
      "ssl_certificate $home$/certificate/$domain$/certificate.crt;",
      "ssl_certificate_key $home$/certificate/$domain$/private.key;",
      "",
      "server {",
      "  listen 80;",
      "  server_name $name$.$domain$ www.$name$.$domain$;",
      "  return 301 https://$server_name$request_uri;",
      "}",
      "",
      "server {",
      "  listen 443 ssl http2;",
      "  server_name $name$.$domain$ www.$name$.$domain$;",
      "",
      "  ssl_protocols TLSv1.2 TLSv1.3;",
      "  ssl_ciphers HIGH:!aNULL:!MD5;",
      "  ssl_prefer_server_ciphers on;",
      "",
      "  gzip on;",
      "  gzip_types text/plain text/css application/json application/javascript text/xml application/xml application/xml+rss text/javascript;",
      "",
      "  location / {",
      "    proxy_pass http://localhost:$port$;",
      "    proxy_http_version 1.1;",
      "    proxy_set_header Upgrade $http_upgrade;",
      "    proxy_set_header Connection 'upgrade';",
      "    proxy_set_header Host $host;",
      "    proxy_cache_bypass $http_upgrade;",
      "    proxy_set_header X-Real-IP $remote_addr;",
      "    proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;",
      "    proxy_set_header X-Forwarded-Proto $scheme;",
      "  }",
      "",
      "  location ~* \\.(js|css|png|jpg|jpeg|gif|ico|svg|woff|woff2|ttf|eot)$ {",
      "    expires 1y;",
      "    add_header Cache-Control \"public, immutable\";",
      "  }"
    ]
  },
  "env": {
    "REACT_APP_ENV": "$type$"
  }
}
